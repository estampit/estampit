# ğŸ¯ MYSTAMP - La Plataforma de FidelizaciÃ³n Digital MÃ¡s Avanzada

![MYSTAMP Logo](https://via.placeholder.com/400x100/6366f1/white?text=MYSTAMP)

> **La soluciÃ³n definitiva de fidelizaciÃ³n digital** que combina lo mejor de StampMe, MagicStamp, LoyiCard, Loyaltify y Stamply en una plataforma revolucionaria.

## ğŸ† Â¿Por QuÃ© MYSTAMP es Superior?

### ğŸš€ **Ventajas Competitivas Ãšnicas**

| CaracterÃ­stica | StampMe | MagicStamp | LoyiCard | Stamply | **MYSTAMP** |
|----------------|---------|------------|----------|---------|-------------|
| **Wallet Integration** | âŒ | âŒ | âœ… | âŒ | **âœ… Avanzada** |
| **NFC + QR Codes** | âœ… | âœ… | âœ… | âœ… | **âœ… + AI Recognition** |
| **Real-time Analytics** | âœ… | âœ… | âŒ | âœ… | **âœ… + Predictive** |
| **Gamification** | âœ… | âŒ | âŒ | âŒ | **âœ… Advanced** |
| **Multi-language** | âŒ | âŒ | âŒ | âœ… | **âœ… + Auto-translate** |
| **White-label** | âŒ | âŒ | âœ… | âœ… | **âœ… + Custom Branding** |
| **Pricing** | Â£29+ | Â£29+ | 30â‚¬+ | $15+ | **Desde 19â‚¬** |

## ğŸŒŸ **CaracterÃ­sticas Revolucionarias**

### ğŸª **Para Comerciantes - Suite Profesional**
- **ğŸ¯ Smart Loyalty Engine**: IA que optimiza automÃ¡ticamente las recompensas
- **ğŸ“Š Analytics Predictivos**: Predice comportamiento de clientes y churn
- **ğŸ’° Dynamic Pricing**: Ajusta recompensas segÃºn demanda y comportamiento
- **ğŸ”„ Omnichannel Experience**: Online, in-store, mobile y social media
- **ğŸ¤– AI-Powered Insights**: Recomendaciones automÃ¡ticas para aumentar retenciÃ³n
- **ğŸ¨ Custom Branding**: White-label completo con tu marca
- **ğŸ“ˆ Revenue Optimization**: Aumenta ticket medio y frecuencia de compra
- **ğŸŒ Multi-location Management**: GestiÃ³n centralizada para cadenas
- **ğŸ”— Universal Integrations**: Conecta con cualquier POS, CRM o e-commerce
- **ğŸ“± Staff Mobile App**: App dedicada para empleados

### ğŸ“± **Para Clientes - Experiencia Premium**
- **ğŸ’³ Universal Wallet**: Apple Wallet + Google Pay + Samsung Pay
- **ğŸ® Gamification Avanzada**: Niveles, logros, desafÃ­os y competencias
- **ğŸ Smart Rewards**: Recompensas personalizadas por IA
- **ğŸ“ Geolocation Magic**: Ofertas automÃ¡ticas al estar cerca del negocio
- **ğŸ¤ Social Sharing**: Comparte logros y refiere amigos
- **ğŸ”” Smart Notifications**: Notificaciones contextuales inteligentes
- **ğŸ’ VIP Programs**: Programas exclusivos para clientes premium
- **ğŸ¯ Personalization**: Experiencia 100% personalizada

## ğŸ—ï¸ Arquitectura del Proyecto

```
MYSTAMP/
â”œâ”€â”€ ğŸ“± apps/
â”‚   â”œâ”€â”€ web/              # Portal web para comerciantes (Next.js 14)
â”‚   â”œâ”€â”€ mobile/           # App mÃ³vil para clientes (React Native)
â”‚   â””â”€â”€ admin/            # Dashboard administrativo (Next.js)
â”œâ”€â”€ ğŸ“¦ packages/
â”‚   â”œâ”€â”€ shared/           # Utilidades y tipos compartidos
â”‚   â”œâ”€â”€ ui/              # Componentes UI reutilizables
â”‚   â””â”€â”€ database/        # Cliente Supabase y tipos de BD
â”œâ”€â”€ ğŸ”§ backend/
â”‚   â”œâ”€â”€ supabase/        # ConfiguraciÃ³n de Supabase
â”‚   â”œâ”€â”€ functions/       # Edge Functions
â”‚   â””â”€â”€ migrations/      # Migraciones de base de datos
â”œâ”€â”€ ğŸ’³ wallet/
â”‚   â”œâ”€â”€ apple-wallet/    # Apple Wallet passes
â”‚   â””â”€â”€ google-wallet/   # Google Wallet passes
â””â”€â”€ ğŸ“š docs/             # DocumentaciÃ³n del proyecto
```

## ğŸš€ Stack TecnolÃ³gico Superior

### **Frontend Ecosystem**
- **Next.js 14** - App Router + Server Components
- **TypeScript** - Type safety completo
- **Tailwind CSS + Framer Motion** - UI moderna y animaciones
- **Zustand + React Query** - State management optimizado
- **React Hook Form + Zod** - Formularios robustos

### **Mobile Nativo**
- **React Native + Expo** - Cross-platform nativo
- **Apple Wallet SDK** - PassKit integration
- **Google Wallet API** - Wallet passes Android
- **NFC + QR + AI Recognition** - MÃºltiples mÃ©todos de stamp

### **Backend Inteligente**
- **Supabase** - PostgreSQL + Real-time + Auth
- **Edge Functions** - Serverless computing
- **OpenAI GPT-4** - AI nativo para personalizaciÃ³n
- **TensorFlow.js** - ML en el edge
- **Row Level Security** - Seguridad enterprise

### **Integraciones Universales**
- **Stripe + PayPal** - Pagos globales
- **Twilio + SendGrid** - Comunicaciones
- **POS Universal API** - Conecta con cualquier POS
- **Cloudinary + Vercel** - Assets y deployment
- **Mixpanel + Analytics** - MÃ©tricas avanzadas

## ğŸ› ï¸ ConfiguraciÃ³n de Desarrollo

### Prerrequisitos
```bash
# Node.js 18+
node --version

# npm 9+
npm --version

# Git
git --version
```

### InstalaciÃ³n
```bash
# Clonar el repositorio
git clone <repository-url>
cd MYSTAMP

# Instalar dependencias
npm install

# Configurar variables de entorno
cp .env.example .env.local

# Iniciar Supabase local
npm run supabase:start

# Ejecutar en modo desarrollo
npm run dev
```

### Scripts Disponibles
```bash
npm run dev          # Inicia todos los servicios en desarrollo
npm run build        # Construye todas las aplicaciones
npm run web          # Solo la aplicaciÃ³n web
npm run mobile       # Solo la aplicaciÃ³n mÃ³vil
npm run admin        # Solo el dashboard admin
npm run lint         # Linter para todo el proyecto
npm run test         # Tests unitarios
npm run type-check   # VerificaciÃ³n de tipos TypeScript
npm run verify:remote # Verifica que el esquema remoto coincida con lo esperado
```

## ğŸ” Seguridad y Buenas PrÃ¡cticas

La plataforma aplica una estrategia de "defensa en profundidad". A continuaciÃ³n se detallan los principios y pautas que debes seguir para mantener la seguridad conforme el proyecto crece.

### 1. Claves de Supabase

- `NEXT_PUBLIC_SUPABASE_ANON_KEY`: Se puede exponer en el bundle del navegador. Se usa Ãºnicamente con `supabaseClient` (cliente pÃºblico).
- `SUPABASE_SERVICE_ROLE_KEY`: **Nunca** debe enviarse al navegador ni a apps mÃ³viles. Tiene permisos para saltar Row Level Security (RLS). Ãšsala solo desde backend (Server Components, Server Actions, Route Handlers o scripts). 
  - En local estÃ¡ en `.env.local` solo para acelerar el desarrollo; en producciÃ³n debe residir en variables seguras (Vercel Project Settings / GitHub Actions secrets).
  - Rotar la clave inmediatamente si sospechas exposiciÃ³n: Dashboard Supabase â†’ Settings â†’ API â†’ Generate new service role.

### 2. Clientes de Base de Datos

- `supabaseClient.ts`: Cliente pÃºblico (anon) cacheado para el navegador.
- `serverSupabaseClient.ts`: Crea un cliente efÃ­mero con la Service Role Key y `persistSession: false` para minimizar riesgos. Ãšsalo Ãºnicamente cuando:
  - Necesites llamadas a funciones RPC que requieren bypass RLS (ej. tareas administrativas, migraciones lÃ³gicas, normalizaciones).
  - Realices operaciones internas de mantenimiento (regenerar pases, invalidar tokens, procesos batch).
- Preferencia: siempre intentar primero diseÃ±o de RLS + policies adecuadas para permitir uso del cliente anon antes de recurrir al service role.

### 3. Row Level Security (RLS)

- Asegura que todas las tablas sensibles tengan RLS activado y polÃ­ticas explÃ­citas (lectura/escritura). 
- Verifica al agregar nuevas tablas: tras la migraciÃ³n, ejecutar `npm run verify:remote` (ver secciÃ³n de verificaciÃ³n) y revisar manualmente RLS.
- Evita crear funciones SQL con `SECURITY DEFINER` salvo que sea estrictamente necesario; documenta cada caso.

### 4. SeparaciÃ³n de Entornos

- Usa archivos/vars separados por entorno: `.env.local`, `.env.development`, `.env.production` (o variables gestionadas por el proveedor de despliegue).
- Nunca commitear `.env.local` ni colocar valores reales en ejemplos.
- Para CI/CD usar secrets de pipeline (ej. `SUPABASE_SERVICE_ROLE_KEY`, `SUPABASE_DB_PASSWORD`).

### 5. AuditorÃ­a y VerificaciÃ³n

- Script `npm run verify:remote` llama a la funciÃ³n RPC `get_platform_objects` y compara tablas/funciones esperadas.
- Extensiones futuras: validar columnas crÃ­ticas, tipos y presencia de Ã­ndices.
- AÃ±adir a CI como paso temprano para prevenir despliegues inconsistentes.

### 6. Manejo de Pases y Tokens

- Tokens de wallet / QR deben tener expiraciÃ³n corta (pendiente de implementaciÃ³n). No reutilizar tokens revocados.
- Al regenerar un pase: invalidar todas las versiones previas y registrar evento en la tabla de logs.
- No almacenar tokens sin hashing si representan secretos reutilizables; considerar hash + salt si escala la sensibilidad.

### 7. Observabilidad y Logging

- Usa la funciÃ³n `log_event` para registrar acciones sensibles (revocaciones, regeneraciones, cambios de plan, upgrades de features).
- A futuro: configurar retenciÃ³n y exportaciÃ³n a un sistema externo (Logflare / ClickHouse / BigQuery) para anÃ¡lisis forense.

### 8. Minimizar Superficie de Ataque

- No exponer endpoints que realicen acciones privilegiadas sin control de autenticaciÃ³n + autorizaciÃ³n + rate limiting.
- Limitar payloads mÃ¡ximos (body size) y validar entrada con Zod en capas server.
- Implementar protecciÃ³n CSRF para endpoints mutadores accesibles vÃ­a navegador (si se usan cookies). Con el patrÃ³n actual (tokens + fetch) el riesgo es menor, pero documentar.

### 9. RotaciÃ³n y RevocaciÃ³n

- Mantener un playbook: (1) Generar nueva service role key, (2) Actualizar variables de despliegue, (3) Invalidar builds anteriores, (4) Forzar redeploy.
- Registrar en `log_event` la rotaciÃ³n (acciÃ³n: `service_role_rotation`).

### 10. PrÃ³ximas Mejoras (Pendientes)

- ExpiraciÃ³n y cooldown de tokens QR / wallet.
- Event Feed UI para auditorÃ­a rÃ¡pida.
- Ãndices en columnas de auditorÃ­a para acelerar queries (ej. `created_at DESC`).
- IntegraciÃ³n con un WAF / Edge Middleware para filtrar anomalÃ­as.
- GeneraciÃ³n automÃ¡tica de tipos de DB (requiere Docker / shadow DB) para reforzar type safety.

### Resumen RÃ¡pido

| Ãrea | Regla Clave |
|------|-------------|
| Claves | Service Role solo server, rotar si se filtra |
| RLS | Activado + polÃ­ticas explÃ­citas |
| Tokens | ExpiraciÃ³n corta + revocaciÃ³n |
| Logging | Registrar operaciones sensibles |
| VerificaciÃ³n | `npm run verify:remote` en CI |
| Tipos | Generar tipos DB para evitar errores |

Si encuentras una nueva operaciÃ³n que exige el service role, pregÃºntate primero: Â¿puedo modelar esto con polÃ­ticas RLS seguras? Solo si la respuesta es no documentada / muy costosa, usa el cliente server y documenta el motivo.

---

## ğŸ“‹ Roadmap

### Fase 1 - MVP (Q4 2024)
- [x] Setup del proyecto y arquitectura
- [ ] AutenticaciÃ³n y registro de usuarios
- [ ] CreaciÃ³n bÃ¡sica de tarjetas de fidelizaciÃ³n
- [ ] App mÃ³vil con funcionalidad core
- [ ] Dashboard bÃ¡sico para comerciantes

### Fase 2 - CaracterÃ­sticas Avanzadas (Q1 2025)
- [ ] Sistema de gamificaciÃ³n
- [ ] Analytics avanzados
- [ ] IntegraciÃ³n con Wallet passes
- [ ] Sistema de comunicaciones
- [ ] API pÃºblica para integraciones

### Fase 3 - Escalabilidad (Q2 2025)
- [ ] Multi-idioma y localizaciÃ³n
- [ ] Inteligencia artificial y recomendaciones
- [ ] Marketplace de comerciantes
- [ ] Programa de afiliados
- [ ] App para Apple Watch y wearables

## ğŸ¤ ContribuciÃ³n

1. Fork el proyecto
2. Crea una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

## ğŸ“„ Licencia

Este proyecto estÃ¡ bajo la Licencia MIT - ver el archivo [LICENSE](LICENSE) para mÃ¡s detalles.

## ğŸ“ Contacto

- **Website**: [mystamp.app](https://mystamp.app)
- **Email**: hello@mystamp.app
- **Twitter**: [@mystampapp](https://twitter.com/mystampapp)
- **LinkedIn**: [MYSTAMP](https://linkedin.com/company/mystamp)

---

<p align="center">
  Hecho con â¤ï¸ por el equipo de MYSTAMP
</p>